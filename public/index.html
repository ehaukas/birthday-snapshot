<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1548, initial-scale=1.0">
  <title>Gratulerer med dagen!</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: white;
      font-family: 'Open Sans', sans-serif;
      height: 100%;
      width: 100%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      position: relative;
      width: 100%;
      height: 100%;
      background-image: url('cake-v2.png');
      background-size: cover;
      background-position: center;
    }
    .card.no-bg {
      background-image: none !important;
      background-color: white !important;
    }
    #greetingText {
      position: absolute;
      left: 55%;
      width: 40%;
      color: rgba(47, 84, 154, 0.72);
      font-size: 2.4vw;
      line-height: 1.5;
    }
    .rate-label { color: #2F549A; font-weight: bold; }
    .rate-value { color: rgba(47, 84, 154, 0.72); }
    .timestamp { font-size: 0.7em; color: #7F8C8D; margin-left: 0; line-height: 1.1; }
    .name-block { display: flex; flex-direction: column; align-items: flex-start; text-align: left; }
    p { margin: 0 0 1em 0; }
  </style>
</head>
<body>
  <div class="card">
    <div id="greetingText"></div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      loadCSV().then(data => {
        const today = getTodayBirthdays(data);
        renderGreetings(today);
      });
    });
    async function loadCSV() {
      const response = await fetch('bursdager.csv');
      const text = await response.text();
      return parseCSV(text);
    }
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const [first, last, company, date] = lines[i].split(',').map(x => x.trim());
        if (first && last && company && date) {
          data.push({ first, last, company, birthdate: date });
        }
      }
      return data;
    }
    function calcAge(birthdate) {
      const [day, month, year] = birthdate.split('.').map(Number);
      const today = new Date();
      let age = today.getFullYear() - year;
      const hasHadBirthday = (today.getMonth() + 1 > month) || (today.getMonth() + 1 === month && today.getDate() >= day);
      return hasHadBirthday ? age : age - 1;
    }
    function getTodayBirthdays(data) {
      const today = new Date();
      const day = today.getDate().toString().padStart(2, '0');
      const month = (today.getMonth() + 1).toString().padStart(2, '0');
      return data.filter(entry => {
        const [d, m] = entry.birthdate.split('.').map(x => x.trim().padStart(2, '0'));
        return d === day && m === month;
      });
    }
    function renderGreetings(list) {
      const container = document.getElementById('greetingText');
      const card = document.querySelector('.card');
      container.innerHTML = '';
      if (list.length === 0) {
        card.classList.add('no-bg');
        return;
      }
      card.classList.remove('no-bg');
      if (list.length === 1) {
        container.style.top = '42%';
        container.style.transform = 'translateY(-50%)';
      } else if (list.length === 2) {
        container.style.top = '8%';
        container.style.transform = 'none';
      } else {
        container.style.top = '4%';
        container.style.transform = 'none';
      }
      list.forEach(entry => {
        const age = calcAge(entry.birthdate);
        const p = document.createElement('p');
        p.innerHTML = `
          <span class="rate-value">Gratulerer med </span><br>
          <span class="rate-label">${age}</span><span class="rate-value">-Ã¥rsdagen,</span><br>
          <div class="name-block">
            <strong class="rate-value">${entry.first}</strong>
            <span class="timestamp">[${entry.company}]</span>
          </div>
        `;
        container.appendChild(p);
      });
      const count = list.length;
      const size = count === 1 ? 5.0 : count === 2 ? 3.0 : count === 3 ? 2.3 : Math.max(1.2, 6.5 / count);
      container.style.fontSize = size + 'vw';
    }
  </script>
</body>
</html>
